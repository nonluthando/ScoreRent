{% extends "base.html" %}
{% block content %}
<h2>Guest evaluation result</h2>

<div class="result">
  <div class="scoreBox">
    <div class="score">{{ result.score }}</div>
    <div class="verdict">{{ result.verdict }}</div>
    <div class="muted small">Confidence: {{ result.confidence }}</div>
  </div>

  <div class="card">
    <h3>Listing summary</h3>
    <ul class="list">
      <li><strong>Name:</strong> {{ listing.listing_name or "Unnamed listing" }}</li>
      <li><strong>Rent:</strong> R{{ listing.rent }}</li>
      <li><strong>Deposit:</strong> R{{ listing.deposit }}</li>
      <li><strong>Application fee:</strong> R{{ listing.application_fee }}</li>
      <li><strong>Demand:</strong> {{ listing.area_demand }}</li>
    </ul>
  </div>

  <div class="card">
    <h3>Reasons</h3>
    <ul class="list">
      {% for r in result.reasons %}
        <li>{{ r }}</li>
      {% endfor %}
    </ul>
  </div>

  <div class="card">
    <h3>Suggested actions</h3>
    <ul class="list">
      {% for a in result.actions %}
        <li>{{ a }}</li>
      {% endfor %}
    </ul>
  </div>

  <!-- ✅ NEW: Score breakdown (expand/collapse) -->
  <div class="card">
    <details>
      <summary style="cursor:pointer; font-weight:800;">
        Show how ScoreRent calculated this score
      </summary>

      <div style="margin-top:14px;">
        {% for step in result.breakdown %}
          <div style="display:flex; justify-content:space-between; gap:12px; padding:10px 0; border-bottom:1px solid #e2e8f0;">
            <div style="flex:1;">
              <strong>{{ step.label }}</strong>
              {% if step.note %}
                <div class="muted small">{{ step.note }}</div>
              {% endif %}
            </div>

            <div style="white-space:nowrap; font-weight:800;">
              {% if step.delta > 0 %}+{{ step.delta }}{% else %}{{ step.delta }}{% endif %}
              → {{ step.score_after }}
            </div>
          </div>
        {% endfor %}
      </div>
    </details>
  </div>

  <div class="actionsRow">
    <a class="btn" href="/evaluate">Evaluate another</a>
    <a class="btn ghost" href="/signup">Sign up to save history</a>
  </div>
</div>
{% endblock %}
