<section class="result">

  {% set confidence = evaluation.confidence.lower() %}
  {% set verdict = evaluation.verdict.replace("_", " ").title() %}

  <div class="score-block">
    <div class="score-number">{{ evaluation.score }}</div>

    <div class="score-verdict {{ confidence }}">
      {{ verdict }}
    </div>

    <div class="score-confidence">
      {{ evaluation.confidence.title() }} confidence
    </div>

    <p class="score-note">
      The score is a practical guide, not a guarantee. It reflects affordability,
      documentation fit, and demand for this listing.
    </p>
  </div>

  <div class="progress-section">
    <div class="progress-label">Overall confidence</div>

    <div class="progress-bar">
      <div
        class="progress-fill {{ confidence }}"
        style="width: {{ evaluation.score }}%;"
      ></div>
    </div>

    <div class="progress-value">{{ evaluation.score }} / 100</div>
  </div>

  <div class="card">
    <h3>Listing summary</h3>
    <div class="summary-grid">
      <div>Name</div><div>{{ listing.listing_name or "Unnamed listing" }}</div>
      <div>Rent</div><div>R{{ listing.rent }}</div>
      <div>Deposit</div><div>R{{ listing.deposit }}</div>
      <div>Application fee</div><div>R{{ listing.application_fee }}</div>
      <div>Demand</div><div>{{ listing.area_demand }}</div>
    </div>
  </div>

  <div class="card">
    <h3>Why this recommendation</h3>
    {% for r in evaluation.reasons %}
      <p class="reason-line">{{ r }}</p>
    {% endfor %}
  </div>

  <div class="card {{ confidence }}">
    <h3>What you should do next</h3>

    <p class="action-primary">
      {{ evaluation.actions[0] }}
    </p>
  </div>

  {% if evaluation.breakdown %}
  <div class="card">
    <details>
      <summary>Show how this score was calculated</summary>

      {% for b in evaluation.breakdown %}
        {% set after = b.after | max(0) | min(100) %}

        <div class="breakdown-item">
          <div class="breakdown-header">
            <span class="breakdown-title">{{ b.title }}</span>
            <span class="breakdown-change">
              {{ b.before }} â†’ {{ b.after }}
            </span>
          </div>

          {% if b.details %}
            <div class="breakdown-details">{{ b.details }}</div>
          {% endif %}

          <div class="progress-bar small">
            <div
              class="progress-fill {{ confidence }}"
              style="width: {{ after }}%;"
            ></div>
          </div>
        </div>
      {% endfor %}
    </details>
  </div>
  {% endif %}

</section>
