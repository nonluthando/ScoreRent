{% extends "base.html" %}
{% block content %}

<section class="stack" style="padding-top: 26px;">
  <div class="stack" style="gap:10px;">
    <h2>Evaluate listing</h2>
    <p>Enter listing details below. Weâ€™ll calculate confidence + recommend what to do next.</p>
  </div>

  <form method="post" class="card stack">

    {% if not user %}
      <div class="card">
        <h3>Your details (Guest)</h3>
        <p class="muted">Guest evaluations require your renter details so we can score the listing correctly.</p>

        <div class="grid-2">
          <div class="stack">
            <label>Renter type</label>
            <select name="guest_renter_type" id="guest_renter_type">
              <option value="worker">Worker</option>
              <option value="new_professional">New professional</option>
              <option value="student">Student</option>
            </select>
          </div>

          <div class="stack">
            <label>Monthly income / support (R)</label>
            <input name="guest_monthly_income" type="number" min="0" placeholder="e.g. 18000" />
          </div>
        </div>

        <div class="stack" id="bursary_block" style="display:none;">
          <label>Are you a bursary student?</label>
          <select name="student_is_bursary">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
          <p class="muted small" style="margin-top:-6px;">
            This helps ScoreRent choose the correct student evaluation rules.
          </p>
        </div>

        <div class="stack">
          <label>Documents you have</label>
          <p class="muted" style="margin-top:-6px;">Tick what you can provide. ScoreRent uses this to check document fit.</p>

          <div class="checkbox-group">
            {% for doc in (doc_clusters["worker"] | sort) %}
              <label class="checkbox">
                <input type="checkbox" name="guest_renter_docs" value="{{ doc }}" />
                <span>{{ doc.replace("_", " ").title() }}</span>
              </label>
            {% endfor %}

            {% for doc in (doc_clusters["new_professional"] | sort) %}
              <label class="checkbox">
                <input type="checkbox" name="guest_renter_docs" value="{{ doc }}" />
                <span>{{ doc.replace("_", " ").title() }}</span>
              </label>
            {% endfor %}

            {% for doc in (doc_clusters["student"] | sort) %}
              <label class="checkbox">
                <input type="checkbox" name="guest_renter_docs" value="{{ doc }}" />
                <span>{{ doc.replace("_", " ").title() }}</span>
              </label>
            {% endfor %}
          </div>
        </div>

        <div class="stack">
          <label>Guarantor monthly income (R) (optional)</label>
          <input name="guest_guarantor_monthly_income" type="number" min="0" placeholder="e.g. 25000" />
          <p class="muted small" style="margin-top:-6px;">
            Only needed for non-bursary student evaluations.
          </p>
        </div>
      </div>
      <hr />
    {% endif %}

    <div class="grid-2">
      <div class="stack">
        <label>Listing name (optional)</label>
        <input name="listing_name" placeholder="e.g. Gardens Studio" />
      </div>

      <div class="stack">
        <label>Area demand</label>
        <select name="area_demand">
          {% for d in demand_levels %}
            <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <hr />

    <div class="grid-2">
      <div class="stack">
        <label>Monthly rent (R)</label>
        <input name="rent" type="number" required min="0" placeholder="e.g. 7500" />
      </div>

      <div class="stack">
        <label>Deposit (R)</label>
        <input name="deposit" type="number" required min="0" placeholder="e.g. 7500" />
      </div>
    </div>

    <div class="grid-2">
      <div class="stack">
        <label>Application fee (R)</label>
        <input name="application_fee" type="number" required min="0" placeholder="e.g. 250" />
      </div>
    </div>

    <hr />

    <div class="stack">
      <label>Required documents (listing)</label>
      <p style="margin-top:-6px;">
        Tick what the listing requires. ScoreRent will check if your profile matches.
      </p>

      <div class="checkbox-group">
        {% for doc in doc_clusters["worker"] | sort %}
          <label class="checkbox">
            <input type="checkbox" name="required_documents" value="{{ doc }}" />
            <span>{{ doc.replace("_", " ").title() }}</span>
          </label>
        {% endfor %}
      </div>
    </div>

    <hr />

    <div class="actions">
      <button class="btn" type="submit">Evaluate</button>
      {% if not user %}
        <a class="btn secondary" href="/signup">Sign up to save results</a>
      {% endif %}
    </div>
  </form>
</section>

<script>
  const renterTypeSelect = document.getElementById("guest_renter_type");
  const bursaryBlock = document.getElementById("bursary_block");

  function updateBursaryVisibility() {
    if (!renterTypeSelect || !bursaryBlock) return;
    bursaryBlock.style.display = (renterTypeSelect.value === "student") ? "block" : "none";
  }

  if (renterTypeSelect) {
    renterTypeSelect.addEventListener("change", updateBursaryVisibility);
    updateBursaryVisibility();
  }
</script>

{% endblock %}
