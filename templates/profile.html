{% extends "base.html" %}
{% block content %}

<section class="stack" style="padding-top: 26px;">
  <div class="stack" style="gap:10px;">
    <h2>Your renter profile</h2>
    <p>
      This profile is used when evaluating listings. You can update it anytime.
    </p>
  </div>

  <form method="post" class="card stack">
    <div class="grid-2">
      <div class="stack">
        <label>Renter type</label>
        <select id="renter_type" name="renter_type" required>
          <option value="worker" {% if renter_type=="worker" %}selected{% endif %}>Worker</option>
          <option value="new_professional" {% if renter_type=="new_professional" %}selected{% endif %}>New Professional</option>
          <option value="student" {% if renter_type=="student" %}selected{% endif %}>Student</option>
        </select>
      </div>

      <div class="stack">
        <label>Monthly income (R)</label>
        <input name="monthly_income" type="number" min="0" required value="{{ monthly_income }}" />
      </div>
    </div>

    <hr />

    <div class="stack">
      <div class="stack" style="gap:4px;">
        <label>Documents you have</label>
        <p style="margin-top:-4px;">
          Tick what you can provide â€” this will impact confidence & recommendations.
        </p>
      </div>

      <div id="docs_box" class="checkbox-group"></div>
    </div>

    <div class="actions">
      <button class="btn" type="submit">Save profile</button>
      <a class="btn secondary" href="/evaluate">Evaluate listing</a>
    </div>
  </form>

  <div class="card stack" style="margin-top: 18px;">
    <h3>Recommended docs (based on renter type)</h3>
    <ul id="recommended_docs" style="margin: 0; padding-left: 18px;"></ul>
  </div>
</section>

<script>
  const DOC_CLUSTERS = {{ doc_clusters | tojson }};
  const docsSelected = {{ docs_selected | tojson }};

  function titleize(s) {
    return s.replaceAll("_", " ").replace(/\b\w/g, c => c.toUpperCase());
  }

  function renderDocs(renterType) {
    const docs = DOC_CLUSTERS[renterType] || [];
    const box = document.getElementById("docs_box");

    box.innerHTML = docs.map(doc => {
      const checked = docsSelected.includes(doc) ? "checked" : "";
      return `
        <label class="checkbox">
          <input type="checkbox" name="renter_docs" value="${doc}" ${checked}/>
          <span>${titleize(doc)}</span>
        </label>
      `;
    }).join("");
  }

  function renderRecommended(renterType) {
    const docs = DOC_CLUSTERS[renterType] || [];
    const list = document.getElementById("recommended_docs");

    list.innerHTML = docs.map(d => `<li>${titleize(d)}</li>`).join("");
  }

  const select = document.getElementById("renter_type");
  renderDocs(select.value);
  renderRecommended(select.value);

  select.addEventListener("change", (e) => {
    renderDocs(e.target.value);
    renderRecommended(e.target.value);
  });
</script>

{% endblock %}
