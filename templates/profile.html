{% extends "base.html" %}
{% block content %}

<section class="stack" style="padding-top: 26px;">
  <div class="stack" style="gap:10px;">
    <h2>Renter profile</h2>
    <p>Save your profile once — then ScoreRent will evaluate listings consistently.</p>
  </div>

  <form method="post" class="card stack">
    <div class="grid-2">
      <div class="stack">
        <label>Renter type</label>
        <select name="renter_type" id="renterType" required>
          {% for t in doc_clusters.keys() %}
            <option value="{{ t }}" {% if renter_type == t %}selected{% endif %}>
              {{ t.replace("_", " ").title() }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="stack">
        <label>Monthly income (R)</label>
        <input
          name="monthly_income"
          type="number"
          min="0"
          required
          value="{{ monthly_income }}"
          placeholder="e.g. 18000"
        />
      </div>
    </div>

    <!-- ✅ bursary checkbox FIRST -->
    <div id="bursaryWrap" class="stack" style="display:none;">
      <label>Student support</label>
      <label class="checkbox" style="margin-top:6px;">
        <input type="checkbox" name="is_bursary_student" value="true" {% if profile and profile.is_bursary_student %}checked{% endif %}/>
        <span>Bursary student (income/support covers rent)</span>
      </label>
      <p style="margin-top:-6px;">This affects affordability rules for students.</p>
    </div>

    <div id="guarantorWrap" class="stack" style="display:none;">
      <label>Guarantor monthly income (R)</label>
      <input
        name="guarantor_monthly_income"
        type="number"
        min="0"
        value="{% if profile %}{{ profile.guarantor_monthly_income }}{% else %}0{% endif %}"
        placeholder="e.g. 22000"
      />
      <p style="margin-top:-6px;">Only needed for non-bursary students.</p>
    </div>

    <hr />

    <div class="stack">
      <label>Documents you can provide</label>
      <p style="margin-top:-6px;">Select all documents you can submit with an application.</p>

      <div class="checkbox-group">
        {% for doc in doc_clusters[renter_type] %}
          <label class="checkbox">
            <input
              type="checkbox"
              name="renter_docs"
              value="{{ doc }}"
              {% if doc in docs_selected %}checked{% endif %}
            />
            <span>{{ doc.replace("_", " ").title() }}</span>
          </label>
        {% endfor %}
      </div>
    </div>

    <div class="actions">
      <button class="btn" type="submit">Save profile</button>
      <a class="btn secondary" href="/evaluate">Go evaluate</a>
    </div>
  </form>
</section>

<script>
  function syncStudentFields() {
    const renterType = document.getElementById("renterType").value;
    const bursaryWrap = document.getElementById("bursaryWrap");
    const guarantorWrap = document.getElementById("guarantorWrap");

    const isStudent = renterType === "student";
    bursaryWrap.style.display = isStudent ? "block" : "none";
    guarantorWrap.style.display = isStudent ? "block" : "none";
  }

  document.getElementById("renterType").addEventListener("change", syncStudentFields);
  syncStudentFields();
</script>

{% endblock %}
